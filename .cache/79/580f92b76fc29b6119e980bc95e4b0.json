{"id":"../../models/tourModel.js","dependencies":[{"name":"C:\\Users\\Dell\\Downloads\\4-natours\\package.json","includedInParent":true,"mtime":1738438436952},{"name":"mongoose","loc":{"line":1,"column":25,"index":25},"parent":"C:\\Users\\Dell\\Downloads\\4-natours\\models\\tourModel.js","resolved":"C:\\Users\\Dell\\Downloads\\4-natours\\node_modules\\mongoose\\dist\\browser.umd.js"},{"name":"slugify","loc":{"line":2,"column":24,"index":63},"parent":"C:\\Users\\Dell\\Downloads\\4-natours\\models\\tourModel.js","resolved":"C:\\Users\\Dell\\Downloads\\4-natours\\node_modules\\slugify\\slugify.js"}],"generated":{"js":"var mongoose = require('mongoose');\nvar slugify = require('slugify');\n// const validator = require('validator');\n// const User = require('./userModel');\n\n// first argument is schema definition and second argument is object options\nvar tourSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'A tour must have a name'],\n    unique: true,\n    trim: true,\n    maxlength: [40, 'A tour name must have less or equal than 40 characters'],\n    minlength: [10, 'A tour name must have more or equal than 10 characters']\n    // validate: [validator.isAlpha, 'Tour name must only contain characters'],\n  },\n  slug: String,\n  duration: {\n    type: Number,\n    required: [true, 'A tour must have a duration']\n  },\n  maxGroupSize: {\n    type: Number,\n    required: [true, 'A tour must have a group size']\n  },\n  difficulty: {\n    type: String,\n    required: [true, 'A tour must have a difficulty'],\n    enum: {\n      values: ['easy', 'medium', 'difficult'],\n      // only these values are allowed\n      message: 'Difficulty is either: easy, medium, difficult'\n    }\n  },\n  ratingsAverage: {\n    type: Number,\n    default: 4.5,\n    min: [1, 'Rating must be above 1.0'],\n    max: [5, 'Rating must be below 5.0'],\n    set: function set(val) {\n      return Math.round(val * 10) / 10;\n    } // 4.66666 => 46.6666 => 47 => 4.7\n  },\n  ratingsQuantity: {\n    type: Number,\n    default: 0\n  },\n  price: {\n    type: Number,\n    required: [true, 'A tour must have a price']\n  },\n  priceDiscount: {\n    type: Number,\n    validate: {\n      validator: function validator(val) {\n        return val < this.price;\n      },\n      message: 'Discount price ({VALUE}) should be below regular price'\n    }\n  },\n  summary: {\n    type: String,\n    trim: true,\n    // removes white spaces\n    required: [true, 'A tour must have a summary']\n  },\n  description: {\n    type: String,\n    trim: true\n  },\n  imageCover: {\n    type: String,\n    required: [true, 'A tour must have a cover image']\n  },\n  images: [String],\n  // array of strings\n  createdAt: {\n    type: Date,\n    default: Date.now(),\n    select: false // hide this field from client\n  },\n  startDates: [{\n    date: {\n      type: String,\n      required: [true, 'A tour must have a date to can users book it']\n    },\n    soldOut: {\n      type: Boolean,\n      default: false\n    },\n    bookedPersons: {\n      type: Number,\n      default: 0\n    }\n  }],\n  secretTour: {\n    type: Boolean,\n    default: false\n  },\n  startLocation: {\n    // GeoJSON\n    type: {\n      type: String,\n      default: 'Point',\n      enum: ['Point']\n    },\n    coordinates: [Number],\n    address: String,\n    description: String\n  },\n  // embedded document\n  locations: [{\n    type: {\n      type: String,\n      default: 'Point',\n      enum: ['Point']\n    },\n    coordinates: [Number],\n    address: String,\n    description: String,\n    day: Number\n  }],\n  // embedded document => guides means users, array of users\n  // guides: Array,\n  // child referencing => array of user ids => user [child] and tour [parent]\n  guides: [{\n    user: {\n      type: mongoose.Schema.ObjectId,\n      ref: 'User'\n    },\n    bookings: [{\n      date: {\n        type: Date\n      },\n      bookedPersons: {\n        type: Number,\n        min: [1, 'At least one person should be booked']\n      }\n    }]\n  }]\n}, {\n  toJSON: {\n    virtuals: true\n  },\n  // each time we get data out from db, it will be part of the output\n  toObject: {\n    virtuals: true\n  } // get data as object\n});\n\n// index => create index in database to speed up queries and improve performance of queries [most common queries]\ntourSchema.index({\n  price: 1,\n  ratingsAverage: -1\n});\ntourSchema.index({\n  slug: 1\n});\ntourSchema.index({\n  startLocation: '2dsphere'\n});\n\n// virtual property that is not stored in db and created each time we get data out from db\ntourSchema.virtual('durationWeeks').get(function () {\n  return this.duration / 7;\n});\n\n// virtual populate => get reviews for each tour without save it in Tour database\n// reviews => field name [array of reviews], Review [child] database name and tour foreign key or foreign field that have the tour id in Review database, local field that have the tour id in Tour database\ntourSchema.virtual('reviews', {\n  ref: 'Review',\n  foreignField: 'tour',\n  localField: '_id'\n});\n\n// document middleware pre => runs before an actual event => .save() and .create() only means that this function will run before the document save to db\ntourSchema.pre('save', function (next) {\n  this.slug = slugify(this.name, {\n    lower: true\n  });\n  next();\n});\n\n// embedding or denormalization\n// tourSchema.pre('save', async function (next) {\n//   const guidesPromises = this.guides.map(async (id) => await User.findById(id));\n//   this.guides = await Promise.all(guidesPromises);\n//   next();\n// });\n\n// post middleware => executed after all the pre middleware functions have completed\n// tourSchema.post('save', function (doc, next) {\n//   console.log(doc);\n//   next();\n// });\n\n// query middleware => executed before any find query is executed\n// returns all the tours that are not secret\n// /^find/ => any functions start with find\ntourSchema.pre(/^find/, function (next) {\n  this.find({\n    secretTour: {\n      $ne: true\n    }\n  });\n  // this.start = Date.now();\n  next();\n});\n\n// populate => replace user id's with the actual data or fill up the field [guides] with data without __v and passwordChangedAt\ntourSchema.pre(/^find/, function (next) {\n  this.populate({\n    path: 'guides.user',\n    select: '-__v -passwordChangedAt -confirmedEmail'\n  });\n  next();\n});\n\n// post middleware => executed after all the pre middleware functions have completed\n// tourSchema.post(/^find/, function (docs, next) {\n//   console.log(`Query took ${Date.now() - this.start} milliseconds!`); // in milliseconds\n//   next();\n// });\n\n// aggregate middleware => executed before any aggregate query is executed\n// returns all the tours that are not secret, when we use aggregate (match) method\n// tourSchema.pre('aggregate', function (next) {\n//   this.pipeline().unshift({ $match: { secretTour: { $ne: true } } });\n//   next();\n// });\n\n// models name and variables should be start with uppercase.\nvar Tour = mongoose.model('Tour', tourSchema); // 'Tour' is the name of the collection (table)\n\nmodule.exports = Tour;"},"sourceMaps":null,"error":null,"hash":"65074f745422bdc28d925341130ec130","cacheData":{"env":{}}}